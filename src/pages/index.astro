---
import Papa from 'papaparse'
import { timeParse } from 'd3'

import TimelineChart from '@/components/Chart'
import Layout from '@layouts/Layout.astro'

import type { TimelineChartDataEntry, TimelineChartRawDataEntry } from '@types'

// import { data as rawData } from '../data/money-market_data'
// import { config } from '../data/money-market_config'
import { data as rawData } from '../data/fed-funds_data'
import { config } from '../data/fed-funds_config'
// import { data as rawData } from '../data/stock-prices_data'
// import { config } from '../data/stock-prices_config'

const { errors, data: parsedData }: { errors: any[]; data: any[] } = Papa.parse(rawData, {
	dynamicTyping: true,
})

if (errors.length) {
	throw new Error(`Error parsing data: ${JSON.stringify(errors)}`)
}

const columns: string[] = parsedData[0]
const dataset: TimelineChartRawDataEntry[] = parsedData.slice(1)

const [dateKey, ...series] = columns
const dateParser = timeParse('%d/%m/%Y')
const data: TimelineChartDataEntry[] = dataset.map(([dateStr, ...values]) => [
	dateParser(dateStr)!,
	...values,
])
// console.log(data)
---

<Layout>
	<TimelineChart data={data} series={series} config={config} client:load />
</Layout>
